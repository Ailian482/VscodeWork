- 火车票自主预订异常转人工
  - 授信订单
    - 1.订单付款状态
      - 部分出票失败
        - 不存在保险
          - 付款状态为「已记账」
        - 存在保险
          - 保险已处理
            - 投保成功，付款状态为「已记账」
            - 投保失败，付款状态为「已记账」
          - 保险未处理
            - 付款状态为「预记账」
      - 全部出票失败
        - 付款状态为「未付款」，保险状态为「已取消」（×）
      - 全部出票成功
        - 不存在保险
          - 付款状态为「已记账」
        - 存在保险
          - 保险未处理
            - 付款状态为「预记账」
          - 保险已处理
            - 投保成功，付款状态为「已记账」
            - 投保取消，付款状态为「已记账」
    - 2.乘客付款状态、保险状态
      - 出票成功
        - 存在保险
          - 保险已处理
            - 保险取消，付款状态为「已记账」，保险状态为「已取消」
            - 投保成功，付款状态为「已记账」，保险状态为「已购买」
          - 保险未处理
            - 付款状态为「预记账」，保险状态为「待购买」
        - 不存在保险
          - 投保成功，付款状态为「已记账」
      - 出票失败
        - 存在保险
          - 付款状态为「未付款」，保险状态为「已取消」
        - 不存在保险
          - 付款状态为「未付款」
  
  - 个付订单
    - 1.订单付款状态
      - 部分出票失败
        - 无保险
          - 未退款：付款状态为「待退款」
          - 已退款：付款状态为「部分退款」
        - 有保险
          - 出票失败部分未退款
            - 保险已处理
              - 投保成功，付款状态为「待退款」
              - 投保失败
                - 保险未退款，付款状态为「待退款」
                - 保险已退款，付款状态为「待退款」
              - 保险未处理
                - 付款状态为「待退款」
          - 出票失败部分已退款
            - 保险已处理
              - 投保成功，付款状态为「部分退款」
              - 投保失败
                - 保险未退款，付款状态为「待退款」
                - 保险已退款，付款状态为「部分退款」
            - 保险未处理
              - 付款状态为「部分退款」
      - 全部出票失败
        - 付款状态为「待退款」
      - 全部出票成功
        - 不存在差价
          - 付款状态为「已付款」
        - 存在差价
          - 不存在保险
            - 差价未退款，付款状态为「待退款」
            - 差价已退款，付款状态为「部分退款」
          - 存在保险
            - 差价未退款
              - 保险未处理
                - 付款状态为「待退款」
              - 保险已处理
                - 投保成功，付款状态为「待退款」
                - 投保取消，付款状态为「待退款」
            - 差价已退款
              - 保险未处理
                - 付款状态为「部分退款」
              - 保险已处理
                - 投保成功，付款状态为「部分退款」
                - 投保取消
                  - 保险未退款，付款状态为「待退款」
                  - 保险已退款，付款状态为「部分退款」
    - 2.乘客付款状态、保险状态
      - 出票失败
        - 未退款：付款状态为「待退款」，保险状态为「已取消」
        - 已退款：付款状态为「已退款」，保险状态为「已取消」
      - 出票成功
        - 不存在差价
          - 付款状态为「已付款」
        - 存在差价
          - 差价未退款
            - 不存在保险
              - 付款状态为「已付款」
            - 存在保险
              - 保险未处理
                - 付款状态为「已付款」，保险状态为「待购买」
              - 保险已处理
                - 保险取消，付款状态为「已付款」，保险状态为「已取消」
                - 投保成功，付款状态为「已付款」，保险状态为「已购买」
          - 差价已退款，付款状态为「已付款」
            - 不存在保险
              - 付款状态为「已付款」
            - 存在保险
              - 保险未处理
                - 付款状态为「已付款」，保险状态为「待购买」
              - 保险已处理
                - 保险取消，付款状态为「已付款」，保险状态为「已取消」
                - 投保成功，付款状态为「已付款」，保险状态为「已购买」
    - 3.退款操作历史
      - 保险取消
        - 占座成功转人工出票：发起申请退款操作历史，退款成功操作历史
        - 占座失败转人工出票：发起申请退款操作历史，退款成功操作历史
      - 出票失败
        - 占座成功转人工出票：发起申请退款操作历史，退款成功操作历史
        - 占座失败转人工出票：发起申请退款操作历史，退款成功操作历史
      - 差价退款
        - 占座失败转人工出票：发起申请退款操作历史，退款成功操作历史


### 问题
- √ 1. 授信，只处理了部分保险任务，就将已处理保险任务的子订单记录到消费明细（220013153，暂不处理）
- √ 2. 后台订单详情：
  - 金额明细的 席别展示的不是真实的席别信息     ---（乘客下面没有存 席别信息，没有办法展示真实的席别）
- √ 3. 个付，仅存在票差，已退款完成，订单付款状态错误，应该为「部分退款」     ------（现在都为「已付款」，不管）
- √ 4. 个付，投保取消，
  - 待退款，不能申请退改，应该能申请      ---（已解决，乘客付款状态更改为「已付款」）
  - 部分退款，不能申请退改，应该能申请      ---（已解决，乘客付款状态更改为「已付款」）
- √ 5. 个付，票差未退款，保险已退款，订单付款状态被更新为「部分退款」，应该为「待退款」     ---（现在都为「已付款」，不管）
- √ 6. 个付，同一个订单，给多个乘客分别单独购保，最后一个投保任务把前面的投保任务也合并了     ---（已解决）
- √ 7. 个付，原单存在保险任务，也能申请改签，应该不能申请     ---（已解决）
- √ 8. 个付，改签单的票面价，展示为 票面差价      ---（220013751、220013746，已解决，将「票面价」字段名改成「票面补差」）
- √ 9. 退保页面展示异常       ---（已解决）
- √ 10. 授信，存在票差，保险任务还未处理，预记账金额与订单金额对不上      ---（未重新预记账，暂不管）
- √ 11. 授信退票单，保险任务已处理完，付款状态为「已退款」应该为「已记账」      ---（不管，以前就是这样的）
- √ 12. 正常预订，个付，存在投保失败，未退款，订单付款状态为「已付款」应该为「待退款」      ---（不管，以前就是「已付款」）
- √ 13. 正常预订，个付，存在保险（投保成功），申请退票，没有生成退票单      ---（已解决）
- √ 14. 存在差价是，前端传的 票面价值的类型为 字符串，应该为 数值     ---（已解决）
- √ 15. 个付订单，原单退保成功，改签单投保失败，改签单没有退保险款      ---（已解决）
- 16. 正常预订，下单的操作历史，没有填充客服名字      ---（旧bug）
- 17. 改签单，申请改签操作历史，没有记录客服/客户名字     ---（旧bug）

### 问题 2
- √ 1. 个付订单，投保失败，订单付款状态为「已付款」，应该为「待退款」（以前就是这样，暂不修改）
- √ 2. 个付订单，退票时，退保任务还未处理，就生成了退票单的退款任务，导致退保失败后，还需要退保险金额     ---（这个问题我猜之前的考虑是: 如果退保失败，这个保费由我们这边来承担，该退客户多少钱就退多少。）
- √ 3. 个付订单，退票时，退保失败，退票单的保险金额被重置为 0（以前就是这样，暂不修改）
- √ 4. 个付订单，存在其他乘客有退改操作，未投保乘客再申请单独购保，没有自动投保成功，也没有生成投保任务     ---（ 旧 bug，已解决：220013735、220013724）
- √ 5. 个付，同一个订单，给多个乘客分别单独购保，第一个投保任务处理完之后，任务列表还有任务。     ---（220013428-已解决）
- √ 6. 个付，出票成功，多人投保任务，处理任意一个投保任务后，其他人的投保任务处理不了     ---（220013488、220013493-已解决）
- √ 7. 授信，自动出票成功，先记录一条车票款消费明细，投保成功后，又记录一条保险款消费明细     ---（220013499-已解决）
- √ 8. 已记账授信订单，单独购保报错（成功和失败都会报错），因为保险任务还未处理就记账了     ---（220013555-已解决）
- 9. 个付，只有票差退款，操作历史的备注文案有误，提示「取消出票发起退款」     ---（220013624）
- √ 10. 授信，占座失败转人工，一开始投保失败，已经记账，然后再单独购保，购保成功，记了一条保险账，以及一条车票费+2 份保险费     ---（220013615叶兰香-已解决：220013715）
- √ 11. 个付，单独购保，投保失败，生成的退款任务的 收款流水号 错误，记录的是首次支付的 收款流水号。     ---（220013624，这个不是问题，两笔退款都是优先从大金额开始退）
- √ 12. 前台订单详情-金额明细，退票单的应退票款展示错误，展示成支付票面价，应该展示为乘客下的实际票面价。     ---（220013733，已解决）
- 13. 重复多次单独购保，订单金额的保险费计算展示异常      ---（ 旧 bug，后端问题，220013724、220013735）
- √ 14. 后台订单详情-金额明细，存在乘客退票，保险没有展示退票乘客保险费     ---（220013724、220013735）
- √ 15. 占座失败转人工出的票，客户申请退票后，后台退票任务处理不了      ---（已解决：220013788 - 退票单）
- 16. 改签后，如果是先处理改签单投保任务为 失败，再处理原单的退保任务为 失败，订单的金额计算就会有问题，会退掉保险的金额；如果是先处理原单的退保任务为 失败，再处理改签的投保任务为 失败，订单金额计算就没有问题，不会退保险的金额      ---（旧 bug）
- √ 17. 后台退票任务页面展示异常      ---（已解决）
- √ 18. 单独购保，支付页面，前端调用了 手机号解密接口。     ---（旧 bug，已解决）
- √ 19. 后台订单详情，多次单独购保，保险展示异常。      ---（旧 bug，已解决）

- 原单退保成功、改签单投保成功（改签单不计保险金额）
  - 授信：220013563
  - 个付：220013586
- 原单退保失败、改签单投保成功（改签单计算保险金额）
  - 授信：220013560
  - 个付：220013589、220013538
- 原单退保成功、改签单投保失败（改签单需要退保险金额）
  - 授信：220013573、220013720
  - 个付：220013583
- 原单退保失败、改签单投保失败（改签单不计保险金额）
  - 授信：220013576
  - 个付：
  - 先处理改签单再处理原单，订单金额计算有误：220013595、220013646
- 退票，退保失败（退票单不计算保险金额）
  - 授信：220013579、220013733
- 退票，退保成功（退票单需要退保险金额）
  - 授信：220013581、	220013731

